<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="config.mybatis.mapper.oracle.restaurant">
		<sql id="searchWhere">
			<where>
				<if test="keyword!=null and keyword!=''">
					res_name like '%' || #{keyword} || '%'
				</if>
				<if test="locationList!=null">
					<foreach collection="locationList" item="loc" open="and " separator=" or ">
						res_address like '%' || #{loc.sido} || '%' || #{loc.sigungu} || '%'
					</foreach>
				</if>
				<if test="resTypeNo!=0">
					and res_type_no=#{resTypeNo}
				</if>
			</where>
		</sql>

		<insert id="insertRestuarant" parameterType="RestaurantVO">
			<selectKey  keyProperty="resNo" resultType="int" order="BEFORE">
				select restaurant_seq.nextval from dual
			</selectKey>	
				insert into restaurant(res_no,mem_no,food_type_no,res_type_no,res_name,
					res_introduce,res_work_day,res_work_hour,res_thumbnail,
					res_max_person,res_contact1,res_contact2,res_contact3,res_zipcode,res_address,res_address_detail)
					
				values(#{resNo},#{memNo},#{foodTypeNo},#{resTypeNo},#{resName},
					#{resIntroduce},#{resWorkDay},#{resWorkHour},#{resThumbnail},
					#{resMaxPerson},#{resContact1},#{resContact2},#{resContact3},#{resZipcode},#{resAddress},#{resAddressDetail})
		</insert>
	
	
		<select id="selectAll" parameterType="int" resultType="RestaurantVO">
			select * from restaurant
			where mem_no=#{memNo}
		</select>
		
		<select id="selectByNo" parameterType="int" resultType="RestaurantVO">
			select * from restaurant
			where res_no=#{resNo}
		</select>
		
		<select id="searchRestarunt" resultType="RestaurantVO" parameterType="RestaruntSearchVO" >
			select c.*
			from(
				select rownum as rnum, b.*
				from(
					select *
					from restaurant
					<include refid="searchWhere"/>
					order by res_no desc
				)b
			)c
			<![CDATA[
			where c.rnum>#{firstRowNum}
			and c.rnum<=#{pageSize}+#{firstRowNum}
			]]>
		</select>
		
		<select id="countRestarunt" resultType="int" parameterType="RestaruntSearchVO" >
			select count(*)
			from restaurant
			<include refid="searchWhere"/>
			order by res_no desc
		</select>
	
</mapper>